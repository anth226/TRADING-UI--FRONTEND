import React, { FC, useMemo } from 'react';
import { ScaleContinuousNumeric, timeFormat } from 'd3';

export enum TimeMarkType {
  End,
  Start,
}

interface Props {
  xScale: ScaleContinuousNumeric<number, number>
  yScale: ScaleContinuousNumeric<number, number>
  xAccessor: any
  datum: any
  height: number
  type: TimeMarkType
}

const TimeMark: FC<Props> = ({
  height, xAccessor, xScale, datum, yScale, type,
}) => {
  const y = useMemo(() => yScale(datum.close) - 50, [datum, yScale]);
  const x = useMemo(() => xScale(xAccessor(datum)), [datum, xAccessor, xScale]);
  const value = useMemo(() => timeFormat('%y:%m:%d')(datum.date), [datum]);

  return (
    <g>
      <g
        transform={`translate(${x - 15}, ${y - 40})`}
      >
        {type === TimeMarkType.End && (
          <svg width="30" height="30" viewBox="0 0 12 14" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.73605 2.36165C1.67765 2.13112 1.44335 1.99165 1.21282 2.04998C0.982194 2.10844 0.842692 2.3427 0.901118 2.5733L3.71478 13.6749C3.76421 13.87 3.93952 13.9999 4.13194 13.9999C4.16701 13.9999 4.2026 13.9956 4.23813 13.9866C4.46863 13.9282 4.60819 13.6939 4.54977 13.4633L1.73605 2.36165Z" fill="#EA221D" />
            <path d="M11.1016 5.48855C10.6431 3.79539 10.1841 2.10235 9.72543 0.40919C9.67572 0.225914 9.58857 0.0293234 9.26097 0.00966114C6.68224 -0.177099 4.98898 2.39097 2.41021 2.20418C2.20672 2.1791 2.07593 2.28507 2.12561 2.46834C2.58428 4.16147 3.03941 5.85563 3.50175 7.54773C3.57595 7.8193 3.76271 7.92215 3.96627 7.94726C6.54497 8.13405 8.23829 5.56598 10.8171 5.75277C11.0206 5.77779 11.1513 5.67185 11.1016 5.48855ZM9.07795 0.648839C9.20444 1.11597 9.33113 1.58307 9.45763 2.05021C8.91517 2.06807 8.43641 2.17751 7.92908 2.36763C7.80261 1.9005 7.67592 1.43337 7.54946 0.966265C8.05672 0.776208 8.53549 0.666666 9.07795 0.648839ZM3.76405 5.88608C3.62009 5.35536 3.47639 4.82451 3.3326 4.29375C3.9028 4.27723 4.40876 4.15366 4.93799 3.94447C4.81137 3.47734 4.68481 3.0102 4.55831 2.54307C5.07566 2.31182 5.56364 2.03496 6.05233 1.74902C6.17883 2.21612 6.30551 2.68326 6.43204 3.15039C5.94332 3.4363 5.45531 3.71325 4.93799 3.94447C5.08182 4.47523 5.22558 5.00604 5.36938 5.5368C4.84012 5.74596 4.33422 5.86953 3.76405 5.88608ZM5.75466 6.9587C5.6262 6.48475 5.4978 6.01075 5.36938 5.53674C5.88312 5.30723 6.36764 5.03271 6.85285 4.74879C6.98128 5.22279 7.1097 5.69677 7.2381 6.17078C6.75295 6.45473 6.26836 6.72919 5.75466 6.9587ZM6.86333 4.74269C6.71963 4.2119 6.57581 3.68111 6.43204 3.15033C6.92067 2.86504 7.40902 2.59204 7.92908 2.36767C8.07293 2.89842 8.21673 3.42921 8.36049 3.95996C7.84053 4.1844 7.35203 4.45737 6.86333 4.74269ZM8.75473 5.37832C8.62628 4.90437 8.49788 4.43036 8.36942 3.95635C8.87377 3.76829 9.35008 3.66015 9.88898 3.64257C10.0174 4.11658 10.1459 4.59055 10.2743 5.0645C9.73539 5.08211 9.25901 5.19022 8.75473 5.37832Z" fill="#EA221D" />
          </svg>
        )}

        {type === TimeMarkType.Start && (
          <svg width="30" height="30" viewBox="0 0 12 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11.1742 4.71362L10.6184 5.26941C11.5129 6.34281 12 7.68227 12 9.09667C12 12.4083 9.32015 15.0877 6.0091 15.0877C2.69751 15.0877 0.0180664 12.4078 0.0180664 9.09667C0.0180664 5.94806 2.43038 3.40629 5.45602 3.13116V2.01817H4.92143C4.61601 2.01817 4.36845 1.77051 4.36845 1.46509C4.36845 1.15967 4.61601 0.912109 4.92143 0.912109H7.09667C7.40209 0.912109 7.64965 1.15967 7.64965 1.46509C7.64965 1.77051 7.40209 2.01817 7.09667 2.01817H6.56208V3.13116C7.77078 3.24104 8.90388 3.71041 9.83636 4.48737L10.3921 3.93158C10.6081 3.7156 10.9582 3.7156 11.1742 3.93158C11.3902 4.14745 11.3902 4.49765 11.1742 4.71362Z" fill="#59648A" />
            <path d="M8.57186 7.31588C8.78784 7.10001 8.78784 6.74982 8.57186 6.53384C8.35589 6.31786 8.00569 6.31786 7.78971 6.53384L5.61804 8.70562C5.40206 8.92149 5.40206 9.27169 5.61804 9.48767C5.83391 9.70364 6.1841 9.70364 6.40008 9.48767L8.57186 7.31588Z" fill="black" />
          </svg>
        )}
      </g>

      <defs>
        <linearGradient
          id={`marker_gradient_${type}`}
          x2={x}
          y2={height - 60}
          x1={x}
          y1={y}
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor={`${type === TimeMarkType.End ? '#EA221D' : '#fff'}`} offset="0" />
          <stop stopColor={`${type === TimeMarkType.End ? '#EA221D' : '#fff'}`} offset=".7" />
          <stop stopColor="transparent" offset="1" />
        </linearGradient>
      </defs>

      <line
        x1={x}
        y1={height - 60}
        x2={x}
        y2={y}
        stroke={`url(#marker_gradient_${type})`}
        strokeWidth="2"
      />

      <svg width="20" height="60" viewBox="0 0 18 60" x={x - 10} fill="none" y={height - 100}>
        <path fill={`${type === TimeMarkType.End ? '#EA221D' : '#59648A'}`} d="M16.0578 6.82533C16.7891 7.5301 17.2022 8.502 17.2022 9.51758L17.2022 40.0087C17.2022 41.6608 15.8629 43 14.2109 43H3.74131C2.08926 43 0.750006 41.6607 0.750006 40.0087L0.750006 9.51758C0.750006 8.502 1.16311 7.5301 1.89436 6.82533L7.41922 1.5005C8.28819 0.662998 9.664 0.662996 10.533 1.5005L16.0578 6.82533Z" />
        <text fontFamily="Cabin" x="10" y="10" fill="white" fontSize="8px" writingMode="vertical-rl">{value}</text>
      </svg>
    </g>
  );
};

export { TimeMark };
